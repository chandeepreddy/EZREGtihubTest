/*
 * @author           Shahida M
 * @version          1.0 
 * @date             11/14/2016
 * @description      Fetch campaigns that are created 1 hours before . And send campaigns to eligible list of candidate
 * @Modified By      Shahida K
 * @Modified Date    01/18/2017
 * @description      Fetch campaigns that are created 24 hours before . And send campaigns to eligible list of candidate
 */   
public class EZRE_MailChimp_SendCampaign
{
   /* @TestVisible
    private class JSONWrapper
    {
        public string id; 
        public string email;
    }
   
    ///OBJECTIVE
    ///To get the saved campaigns in mailchimp
    ///OBJECTIVE 
    @future (callout=true)
    public static void getMCCmpng(String strCampaignStatus)
    { 
      integer Campignscount = getMCCmpngCount('save');
      try
      {
        DateTime campaignCreatedDateTime = DateTime.Now().addhours(-24);    
        String campaignCreatedDateTimeStr = string.valueOf(campaignCreatedDateTime);
        Set<String> listIdsToDelete=new Set<String>();
        System.debug('Date time to fetch Campaigns from-----------'+campaignCreatedDateTimeStr);
        Mailchimp_Details__c MCAPIDtls = new Mailchimp_Details__c();
        MCAPIDtls = EZRE_Data_Utility.getMCDtls('MCAccount');       
        Http h = new Http();        
        HttpRequest reqst = new HttpRequest();      
        reqst.setMethod('GET'); 
        reqst.setHeader('Authorization', 'apikey '+MCAPIDtls.API_Key__c);
        reqst.setEndpoint('https://'+MCAPIDtls.Domain_Name__c+'.api.mailchimp.com/3.0/campaigns?count='+Campignscount+'&status='+strCampaignStatus+'&since_create_time='+campaignCreatedDateTimeStr);
        
        reqst.setTimeout(120000);
        HttpResponse res = new HttpResponse();
        string strResponseBody;
        if(!Test.isRunningTest())
        {           
            res = h.send(reqst); 
            strResponseBody = res.getBody();
            System.debug('Get Campaigns Response Body-------'+strResponseBody );
        }       
        else
        {
            res.setStatusCode(200);
            strResponseBody ='{"campaigns":[{"id":"5d489f2be4","type":"regular","create_time":"2016-14-09T11:05:37+00:00","archive_url":"http://eepurl.com/cnWe35","long_archive_url":"http://us9.campaign-archive2.com/?u=62148532aa27d5325dd4326f4&id=5d489f2be4","status":"sent","emails_sent":3,"send_time":"2016-11-09T11:05:39+00:00","content_type":"html","recipients":{"list_id":"3f262a9b48","list_name":"Project Manager - 2 - 52972000161656","segment_text":"","recipient_count":3},"settings":{"subject_line":"Need Project Manager - 2 - 52972000161656 in astin, TX for Contract","title":"","from_name":"PreludeSys","reply_to":"indumathi_v@preludesys.com","use_conversation":false,"to_name":"","folder_id":"","authenticate":true,"auto_footer":false,"inline_css":true,"auto_tweet":false,"fb_comments":true,"timewarp":false,"template_id":0,"drag_and_drop":false},"tracking":{"opens":true,"html_clicks":true,"text_clicks":false,"goal_tracking":false,"ecomm360":false,"google_analytics":"","clicktale":"N"},"report_summary":{"opens":2,"unique_opens":2,"open_rate":1,"clicks":0,"subscriber_clicks":0,"click_rate":0,"ecommerce":{"total_orders":0,"total_spent":0,"total_revenue":0}},"delivery_status":{"enabled":false},"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns/5d489f2be4","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"},{"rel":"delete","href":"https://us9.api.mailchimp.com/3.0/campaigns/5d489f2be4","method":"DELETE"},{"rel":"send","href":"https://us9.api.mailchimp.com/3.0/campaigns/5d489f2be4/actions/send","method":"POST"},{"rel":"cancel_send","href":"https://us9.api.mailchimp.com/3.0/campaigns/5d489f2be4/actions/cancel-send","method":"POST"},{"rel":"feedback","href":"https://us9.api.mailchimp.com/3.0/campaigns/5d489f2be4/feedback","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Feedback/Collection.json"},{"rel":"content","href":"https://us9.api.mailchimp.com/3.0/campaigns/5d489f2be4/content","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Content/Collection.json"},{"rel":"send_checklist","href":"https://us9.api.mailchimp.com/3.0/campaigns/5d489f2be4/send-checklist","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Checklist/Collection.json"},{"rel":"pause","href":"https://us9.api.mailchimp.com/3.0/campaigns/5d489f2be4/actions/pause","method":"POST"},{"rel":"resume","href":"https://us9.api.mailchimp.com/3.0/campaigns/5d489f2be4/actions/resume","method":"POST"},{"rel":"replicate","href":"https://us9.api.mailchimp.com/3.0/campaigns/5d489f2be4/actions/replicate","method":"POST"}]},{"id":"1237c83b96","type":"regular","create_time":"2016-11-09T11:22:20+00:00","archive_url":"http://eepurl.com/cnWnd1","long_archive_url":"http://us9.campaign-archive2.com/?u=62148532aa27d5325dd4326f4&id=1237c83b96","status":"sent","emails_sent":2,"send_time":"2016-11-09T11:22:21+00:00","content_type":"html","recipients":{"list_id":"3f262a9b48","list_name":"Project Manager - 2 - 52972000161656","segment_text":"","recipient_count":2},"settings":{"subject_line":"Need Project Manager - 2 - 52972000161656 in astin, TX for Contract","title":"","from_name":"PreludeSys","reply_to":"indumathi_v@preludesys.com","use_conversation":false,"to_name":"","folder_id":"","authenticate":true,"auto_footer":false,"inline_css":true,"auto_tweet":false,"fb_comments":true,"timewarp":false,"template_id":0,"drag_and_drop":false},"tracking":{"opens":true,"html_clicks":true,"text_clicks":false,"goal_tracking":false,"ecomm360":false,"google_analytics":"","clicktale":"N"},"report_summary":{"opens":1,"unique_opens":1,"open_rate":0.5,"clicks":0,"subscriber_clicks":0,"click_rate":0,"ecommerce":{"total_orders":0,"total_spent":0,"total_revenue":0}},"delivery_status":{"enabled":false},"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns/1237c83b96","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"},{"rel":"delete","href":"https://us9.api.mailchimp.com/3.0/campaigns/1237c83b96","method":"DELETE"},{"rel":"send","href":"https://us9.api.mailchimp.com/3.0/campaigns/1237c83b96/actions/send","method":"POST"},{"rel":"cancel_send","href":"https://us9.api.mailchimp.com/3.0/campaigns/1237c83b96/actions/cancel-send","method":"POST"},{"rel":"feedback","href":"https://us9.api.mailchimp.com/3.0/campaigns/1237c83b96/feedback","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Feedback/Collection.json"},{"rel":"content","href":"https://us9.api.mailchimp.com/3.0/campaigns/1237c83b96/content","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Content/Collection.json"},{"rel":"send_checklist","href":"https://us9.api.mailchimp.com/3.0/campaigns/1237c83b96/send-checklist","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Checklist/Collection.json"},{"rel":"pause","href":"https://us9.api.mailchimp.com/3.0/campaigns/1237c83b96/actions/pause","method":"POST"},{"rel":"resume","href":"https://us9.api.mailchimp.com/3.0/campaigns/1237c83b96/actions/resume","method":"POST"},{"rel":"replicate","href":"https://us9.api.mailchimp.com/3.0/campaigns/1237c83b96/actions/replicate","method":"POST"}]},{"id":"13bf8787f9","type":"regular","create_time":"2016-11-09T11:26:52+00:00","archive_url":"http://eepurl.com/cnWpyH","long_archive_url":"http://us9.campaign-archive2.com/?u=62148532aa27d5325dd4326f4&id=13bf8787f9","status":"sent","emails_sent":0,"send_time":"2016-11-09T11:26:55+00:00","content_type":"html","recipients":{"list_id":"3f262a9b48","list_name":"Project Manager - 2 - 52972000161656","segment_text":"","recipient_count":0},"settings":{"subject_line":"Need Project Manager - 2 - 52972000161656 in astin, TX for Contract","title":"","from_name":"PreludeSys","reply_to":"indumathi_v@preludesys.com","use_conversation":false,"to_name":"","folder_id":"","authenticate":true,"auto_footer":false,"inline_css":true,"auto_tweet":false,"fb_comments":true,"timewarp":false,"template_id":0,"drag_and_drop":false},"tracking":{"opens":true,"html_clicks":true,"text_clicks":false,"goal_tracking":false,"ecomm360":false,"google_analytics":"","clicktale":"N"},"report_summary":{"opens":0,"unique_opens":0,"open_rate":0,"clicks":0,"subscriber_clicks":0,"click_rate":0,"ecommerce":{"total_orders":0,"total_spent":0,"total_revenue":0}},"delivery_status":{"enabled":false},"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns/13bf8787f9","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"},{"rel":"delete","href":"https://us9.api.mailchimp.com/3.0/campaigns/13bf8787f9","method":"DELETE"},{"rel":"send","href":"https://us9.api.mailchimp.com/3.0/campaigns/13bf8787f9/actions/send","method":"POST"},{"rel":"cancel_send","href":"https://us9.api.mailchimp.com/3.0/campaigns/13bf8787f9/actions/cancel-send","method":"POST"},{"rel":"feedback","href":"https://us9.api.mailchimp.com/3.0/campaigns/13bf8787f9/feedback","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Feedback/Collection.json"},{"rel":"content","href":"https://us9.api.mailchimp.com/3.0/campaigns/13bf8787f9/content","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Content/Collection.json"},{"rel":"send_checklist","href":"https://us9.api.mailchimp.com/3.0/campaigns/13bf8787f9/send-checklist","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Checklist/Collection.json"},{"rel":"pause","href":"https://us9.api.mailchimp.com/3.0/campaigns/13bf8787f9/actions/pause","method":"POST"},{"rel":"resume","href":"https://us9.api.mailchimp.com/3.0/campaigns/13bf8787f9/actions/resume","method":"POST"},{"rel":"replicate","href":"https://us9.api.mailchimp.com/3.0/campaigns/13bf8787f9/actions/replicate","method":"POST"}]},{"id":"595e9ef3e2","type":"regular","create_time":"2016-11-09T11:34:19+00:00","archive_url":"http://eepurl.com/cnWuhz","long_archive_url":"http://us9.campaign-archive2.com/?u=62148532aa27d5325dd4326f4&id=595e9ef3e2","status":"sent","emails_sent":0,"send_time":"2016-11-09T11:34:20+00:00","content_type":"html","recipients":{"list_id":"3f262a9b48","list_name":"Project Manager - 2 - 52972000161656","segment_text":"","recipient_count":0},"settings":{"subject_line":"Need Project Manager - 2 - 52972000161656 in astin, TX for Contract","title":"","from_name":"PreludeSys","reply_to":"indumathi_v@preludesys.com","use_conversation":false,"to_name":"","folder_id":"","authenticate":true,"auto_footer":false,"inline_css":true,"auto_tweet":false,"fb_comments":true,"timewarp":false,"template_id":0,"drag_and_drop":false},"tracking":{"opens":true,"html_clicks":true,"text_clicks":false,"goal_tracking":false,"ecomm360":false,"google_analytics":"","clicktale":"N"},"report_summary":{"opens":0,"unique_opens":0,"open_rate":0,"clicks":0,"subscriber_clicks":0,"click_rate":0,"ecommerce":{"total_orders":0,"total_spent":0,"total_revenue":0}},"delivery_status":{"enabled":false},"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns/595e9ef3e2","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"},{"rel":"delete","href":"https://us9.api.mailchimp.com/3.0/campaigns/595e9ef3e2","method":"DELETE"},{"rel":"send","href":"https://us9.api.mailchimp.com/3.0/campaigns/595e9ef3e2/actions/send","method":"POST"},{"rel":"cancel_send","href":"https://us9.api.mailchimp.com/3.0/campaigns/595e9ef3e2/actions/cancel-send","method":"POST"},{"rel":"feedback","href":"https://us9.api.mailchimp.com/3.0/campaigns/595e9ef3e2/feedback","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Feedback/Collection.json"},{"rel":"content","href":"https://us9.api.mailchimp.com/3.0/campaigns/595e9ef3e2/content","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Content/Collection.json"},{"rel":"send_checklist","href":"https://us9.api.mailchimp.com/3.0/campaigns/595e9ef3e2/send-checklist","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Checklist/Collection.json"},{"rel":"pause","href":"https://us9.api.mailchimp.com/3.0/campaigns/595e9ef3e2/actions/pause","method":"POST"},{"rel":"resume","href":"https://us9.api.mailchimp.com/3.0/campaigns/595e9ef3e2/actions/resume","method":"POST"},{"rel":"replicate","href":"https://us9.api.mailchimp.com/3.0/campaigns/595e9ef3e2/actions/replicate","method":"POST"}]},{"id":"4c2ffe6684","type":"regular","create_time":"2016-11-09T12:01:13+00:00","archive_url":"http://eepurl.com/cnWKcz","long_archive_url":"http://us9.campaign-archive1.com/?u=62148532aa27d5325dd4326f4&id=4c2ffe6684","status":"sent","emails_sent":0,"send_time":"2016-11-09T12:01:17+00:00","content_type":"html","recipients":{"list_id":"3f262a9b48","list_name":"Project Manager - 2 - 52972000161656","segment_text":"","recipient_count":0},"settings":{"subject_line":"Need Project Manager - 2 - 52972000161656 in astin, TX for Contract","title":"","from_name":"PreludeSys","reply_to":"indumathi_v@preludesys.com","use_conversation":false,"to_name":"","folder_id":"","authenticate":true,"auto_footer":false,"inline_css":true,"auto_tweet":false,"fb_comments":true,"timewarp":false,"template_id":0,"drag_and_drop":false},"tracking":{"opens":true,"html_clicks":true,"text_clicks":false,"goal_tracking":false,"ecomm360":false,"google_analytics":"","clicktale":"N"},"report_summary":{"opens":0,"unique_opens":0,"open_rate":0,"clicks":0,"subscriber_clicks":0,"click_rate":0,"ecommerce":{"total_orders":0,"total_spent":0,"total_revenue":0}},"delivery_status":{"enabled":false},"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c2ffe6684","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"},{"rel":"delete","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c2ffe6684","method":"DELETE"},{"rel":"send","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c2ffe6684/actions/send","method":"POST"},{"rel":"cancel_send","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c2ffe6684/actions/cancel-send","method":"POST"},{"rel":"feedback","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c2ffe6684/feedback","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Feedback/Collection.json"},{"rel":"content","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c2ffe6684/content","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Content/Collection.json"},{"rel":"send_checklist","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c2ffe6684/send-checklist","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Checklist/Collection.json"},{"rel":"pause","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c2ffe6684/actions/pause","method":"POST"},{"rel":"resume","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c2ffe6684/actions/resume","method":"POST"},{"rel":"replicate","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c2ffe6684/actions/replicate","method":"POST"}]},{"id":"11c989e73d","type":"regular","create_time":"2016-11-09T12:59:06+00:00","archive_url":"http://eepurl.com/cnXdUL","long_archive_url":"http://us9.campaign-archive1.com/?u=62148532aa27d5325dd4326f4&id=11c989e73d","status":"sent","emails_sent":4,"send_time":"2016-11-09T13:22:16+00:00","content_type":"html","recipients":{"list_id":"2f72d0c941","list_name":"Management Systems","segment_text":"","recipient_count":4},"settings":{"subject_line":"Need Management Systems in chennai, AK for Contract","title":"","from_name":"PreludeSys","reply_to":"indumathi_v@preludesys.com","use_conversation":false,"to_name":"","folder_id":"","authenticate":true,"auto_footer":false,"inline_css":true,"auto_tweet":false,"fb_comments":true,"timewarp":false,"template_id":0,"drag_and_drop":false},"tracking":{"opens":true,"html_clicks":true,"text_clicks":false,"goal_tracking":false,"ecomm360":false,"google_analytics":"","clicktale":"N"},"report_summary":{"opens":0,"unique_opens":0,"open_rate":0,"clicks":0,"subscriber_clicks":0,"click_rate":0,"ecommerce":{"total_orders":0,"total_spent":0,"total_revenue":0}},"delivery_status":{"enabled":false},"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns/11c989e73d","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"},{"rel":"delete","href":"https://us9.api.mailchimp.com/3.0/campaigns/11c989e73d","method":"DELETE"},{"rel":"send","href":"https://us9.api.mailchimp.com/3.0/campaigns/11c989e73d/actions/send","method":"POST"},{"rel":"cancel_send","href":"https://us9.api.mailchimp.com/3.0/campaigns/11c989e73d/actions/cancel-send","method":"POST"},{"rel":"feedback","href":"https://us9.api.mailchimp.com/3.0/campaigns/11c989e73d/feedback","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Feedback/Collection.json"},{"rel":"content","href":"https://us9.api.mailchimp.com/3.0/campaigns/11c989e73d/content","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Content/Collection.json"},{"rel":"send_checklist","href":"https://us9.api.mailchimp.com/3.0/campaigns/11c989e73d/send-checklist","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Checklist/Collection.json"},{"rel":"pause","href":"https://us9.api.mailchimp.com/3.0/campaigns/11c989e73d/actions/pause","method":"POST"},{"rel":"resume","href":"https://us9.api.mailchimp.com/3.0/campaigns/11c989e73d/actions/resume","method":"POST"},{"rel":"replicate","href":"https://us9.api.mailchimp.com/3.0/campaigns/11c989e73d/actions/replicate","method":"POST"}]},{"id":"a964efd745","type":"regular","create_time":"2016-11-11T10:17:58+00:00","archive_url":"http://eepurl.com/cogrN5","long_archive_url":"http://us9.campaign-archive1.com/?u=62148532aa27d5325dd4326f4&id=a964efd745","status":"sent","emails_sent":0,"send_time":"2016-11-11T10:18:00+00:00","content_type":"html","recipients":{"list_id":"3f262a9b48","list_name":"Project Manager - 2 - 52972000161656","segment_text":"","recipient_count":0},"settings":{"subject_line":"Need Talend Test Engineer in Chennai, GU for Contract","title":"","from_name":"PreludeSys","reply_to":"subhashini_r@preludesys.com","use_conversation":false,"to_name":"","folder_id":"","authenticate":true,"auto_footer":false,"inline_css":true,"auto_tweet":false,"fb_comments":true,"timewarp":false,"template_id":0,"drag_and_drop":false},"tracking":{"opens":true,"html_clicks":true,"text_clicks":false,"goal_tracking":false,"ecomm360":false,"google_analytics":"","clicktale":"N"},"report_summary":{"opens":0,"unique_opens":0,"open_rate":0,"clicks":0,"subscriber_clicks":0,"click_rate":0,"ecommerce":{"total_orders":0,"total_spent":0,"total_revenue":0}},"delivery_status":{"enabled":false},"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns/a964efd745","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"},{"rel":"delete","href":"https://us9.api.mailchimp.com/3.0/campaigns/a964efd745","method":"DELETE"},{"rel":"send","href":"https://us9.api.mailchimp.com/3.0/campaigns/a964efd745/actions/send","method":"POST"},{"rel":"cancel_send","href":"https://us9.api.mailchimp.com/3.0/campaigns/a964efd745/actions/cancel-send","method":"POST"},{"rel":"feedback","href":"https://us9.api.mailchimp.com/3.0/campaigns/a964efd745/feedback","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Feedback/Collection.json"},{"rel":"content","href":"https://us9.api.mailchimp.com/3.0/campaigns/a964efd745/content","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Content/Collection.json"},{"rel":"send_checklist","href":"https://us9.api.mailchimp.com/3.0/campaigns/a964efd745/send-checklist","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Checklist/Collection.json"},{"rel":"pause","href":"https://us9.api.mailchimp.com/3.0/campaigns/a964efd745/actions/pause","method":"POST"},{"rel":"resume","href":"https://us9.api.mailchimp.com/3.0/campaigns/a964efd745/actions/resume","method":"POST"},{"rel":"replicate","href":"https://us9.api.mailchimp.com/3.0/campaigns/a964efd745/actions/replicate","method":"POST"}]},{"id":"78390833cd","type":"regular","create_time":"2016-11-11T12:01:21+00:00","archive_url":"http://eepurl.com/cohl9j","long_archive_url":"http://us9.campaign-archive1.com/?u=62148532aa27d5325dd4326f4&id=78390833cd","status":"sent","emails_sent":2,"send_time":"2016-11-11T12:19:00+00:00","content_type":"html","recipients":{"list_id":"6ba03c8513","list_name":"MailChimpRequirement","segment_text":"","recipient_count":2},"settings":{"subject_line":"Need MailChimpRequirement in chennai, AK for Contract","title":"","from_name":"PreludeSys","reply_to":"indumathi_v@preludesys.com","use_conversation":false,"to_name":"","folder_id":"","authenticate":true,"auto_footer":false,"inline_css":true,"auto_tweet":false,"fb_comments":true,"timewarp":false,"template_id":0,"drag_and_drop":false},"tracking":{"opens":true,"html_clicks":true,"text_clicks":false,"goal_tracking":false,"ecomm360":false,"google_analytics":"","clicktale":"N"},"report_summary":{"opens":0,"unique_opens":0,"open_rate":0,"clicks":0,"subscriber_clicks":0,"click_rate":0,"ecommerce":{"total_orders":0,"total_spent":0,"total_revenue":0}},"delivery_status":{"enabled":false},"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns/78390833cd","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"},{"rel":"delete","href":"https://us9.api.mailchimp.com/3.0/campaigns/78390833cd","method":"DELETE"},{"rel":"send","href":"https://us9.api.mailchimp.com/3.0/campaigns/78390833cd/actions/send","method":"POST"},{"rel":"cancel_send","href":"https://us9.api.mailchimp.com/3.0/campaigns/78390833cd/actions/cancel-send","method":"POST"},{"rel":"feedback","href":"https://us9.api.mailchimp.com/3.0/campaigns/78390833cd/feedback","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Feedback/Collection.json"},{"rel":"content","href":"https://us9.api.mailchimp.com/3.0/campaigns/78390833cd/content","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Content/Collection.json"},{"rel":"send_checklist","href":"https://us9.api.mailchimp.com/3.0/campaigns/78390833cd/send-checklist","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Checklist/Collection.json"},{"rel":"pause","href":"https://us9.api.mailchimp.com/3.0/campaigns/78390833cd/actions/pause","method":"POST"},{"rel":"resume","href":"https://us9.api.mailchimp.com/3.0/campaigns/78390833cd/actions/resume","method":"POST"},{"rel":"replicate","href":"https://us9.api.mailchimp.com/3.0/campaigns/78390833cd/actions/replicate","method":"POST"}]},{"id":"67ce097c13","type":"regular","create_time":"2016-11-11T14:21:45+00:00","archive_url":"http://eepurl.com/coiJLT","long_archive_url":"http://us9.campaign-archive2.com/?u=62148532aa27d5325dd4326f4&id=67ce097c13","status":"sent","emails_sent":8,"send_time":"2016-11-11T14:41:06+00:00","content_type":"html","recipients":{"list_id":"99b65346a1","list_name":"Salesforce","segment_text":"","recipient_count":8},"settings":{"subject_line":"Need Salesforce in banglore, AK for ContractToHire","title":"","from_name":"PreludeSys","reply_to":"indumathi_v@preludesys.com","use_conversation":false,"to_name":"","folder_id":"","authenticate":true,"auto_footer":false,"inline_css":true,"auto_tweet":false,"fb_comments":true,"timewarp":false,"template_id":0,"drag_and_drop":false},"tracking":{"opens":true,"html_clicks":true,"text_clicks":false,"goal_tracking":false,"ecomm360":false,"google_analytics":"","clicktale":"N"},"report_summary":{"opens":0,"unique_opens":0,"open_rate":0,"clicks":0,"subscriber_clicks":0,"click_rate":0,"ecommerce":{"total_orders":0,"total_spent":0,"total_revenue":0}},"delivery_status":{"enabled":false},"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns/67ce097c13","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"},{"rel":"delete","href":"https://us9.api.mailchimp.com/3.0/campaigns/67ce097c13","method":"DELETE"},{"rel":"send","href":"https://us9.api.mailchimp.com/3.0/campaigns/67ce097c13/actions/send","method":"POST"},{"rel":"cancel_send","href":"https://us9.api.mailchimp.com/3.0/campaigns/67ce097c13/actions/cancel-send","method":"POST"},{"rel":"feedback","href":"https://us9.api.mailchimp.com/3.0/campaigns/67ce097c13/feedback","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Feedback/Collection.json"},{"rel":"content","href":"https://us9.api.mailchimp.com/3.0/campaigns/67ce097c13/content","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Content/Collection.json"},{"rel":"send_checklist","href":"https://us9.api.mailchimp.com/3.0/campaigns/67ce097c13/send-checklist","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Checklist/Collection.json"},{"rel":"pause","href":"https://us9.api.mailchimp.com/3.0/campaigns/67ce097c13/actions/pause","method":"POST"},{"rel":"resume","href":"https://us9.api.mailchimp.com/3.0/campaigns/67ce097c13/actions/resume","method":"POST"},{"rel":"replicate","href":"https://us9.api.mailchimp.com/3.0/campaigns/67ce097c13/actions/replicate","method":"POST"}]},{"id":"4c43775ab9","type":"regular","create_time":"2016-11-14T05:03:23+00:00","archive_url":"http://eepurl.com/cow3kz","long_archive_url":"http://us9.campaign-archive1.com/?u=62148532aa27d5325dd4326f4&id=4c43775ab9","status":"sent","emails_sent":2,"send_time":"2016-11-14T05:04:34+00:00","content_type":"html","recipients":{"list_id":"8f9d01dd8e","list_name":"SeniorArchitect","segment_text":"","recipient_count":2},"settings":{"subject_line":"Need SeniorArchitect in Chennai, AR for ContractToHire","title":"","from_name":"PreludeSys","reply_to":"subhashini_r@preludesys.com","use_conversation":false,"to_name":"","folder_id":"","authenticate":true,"auto_footer":false,"inline_css":true,"auto_tweet":false,"fb_comments":true,"timewarp":false,"template_id":0,"drag_and_drop":false},"tracking":{"opens":true,"html_clicks":true,"text_clicks":false,"goal_tracking":false,"ecomm360":false,"google_analytics":"","clicktale":"N"},"report_summary":{"opens":0,"unique_opens":0,"open_rate":0,"clicks":0,"subscriber_clicks":0,"click_rate":0,"ecommerce":{"total_orders":0,"total_spent":0,"total_revenue":0}},"delivery_status":{"enabled":false},"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c43775ab9","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"},{"rel":"delete","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c43775ab9","method":"DELETE"},{"rel":"send","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c43775ab9/actions/send","method":"POST"},{"rel":"cancel_send","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c43775ab9/actions/cancel-send","method":"POST"},{"rel":"feedback","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c43775ab9/feedback","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Feedback/Collection.json"},{"rel":"content","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c43775ab9/content","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Content/Collection.json"},{"rel":"send_checklist","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c43775ab9/send-checklist","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Checklist/Collection.json"},{"rel":"pause","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c43775ab9/actions/pause","method":"POST"},{"rel":"resume","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c43775ab9/actions/resume","method":"POST"},{"rel":"replicate","href":"https://us9.api.mailchimp.com/3.0/campaigns/4c43775ab9/actions/replicate","method":"POST"}]}],"total_items":10,"_links":[{"rel":"parent","href":"https://us9.api.mailchimp.com/3.0/","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Root.json"},{"rel":"self","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"GET","targetSchema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Collection.json","schema":"https://us9.api.mailchimp.com/schema/3.0/CollectionLinks/Campaigns.json"},{"rel":"create","href":"https://us9.api.mailchimp.com/3.0/campaigns","method":"POST","schema":"https://us9.api.mailchimp.com/schema/3.0/Campaigns/Instance.json"}]}';
          
        } 
        if(res.getStatusCode() == 200)
            {  
                
                Map<String, Object> mapRespJSON = (Map<String, Object>)JSON.deserializeUntyped(strResponseBody);
                 List<Object> lstObj = new List<Object>();
                lstObj = (List<Object>)mapRespJSON.get('campaigns');
                    
                Map<String, Object> mapCmpgnsFlag = new Map<String, Object>();
                Map<String, Object> mapSttngsFlag1 = new Map<String, Object>();
                if(lstObj.size() >0)
                {
                    
                    for(Object o: lstObj)
                    {
                         string campignId ;
                         mapCmpgnsFlag = (Map<String, Object>)o;
                         if(mapCmpgnsFlag.containsKey('id'))
                            campignId =  (string)mapCmpgnsFlag.get('id');
                        
                         sendMCCampaign(MCAPIDtls ,campignId);
                         System.debug('Campaign Id passed to sendMCCampaign Method-----'+campignId );
                         System.debug('CreateTime---------'+(string)mapCmpgnsFlag.get('create_time'));       
                     }   
                }  
            }   
      }
      catch(System.CalloutException ex)
      {
        System.debug('## Exception in getMCCmpngCount ##'+ex);
        
      } 
    }
    ///OBJECTIVE
    ///To get the saved campaign count in mailchimp
    ///OBJECTIVE 
    private static integer getMCCmpngCount(String strCampaignStatus)
    {
      integer count=0;
      try
      {
        DateTime campaignCreatedDateTime = DateTime.Now().addhours(-24);   
        String campaignCreatedDateTimeStr = string.valueOf(campaignCreatedDateTime);
        System.debug('time ------11----------'+campaignCreatedDateTimeStr);
        Mailchimp_Details__c MCDetails = new Mailchimp_Details__c();
        MCDetails = EZRE_Data_Utility.getMCDtls('MCAccount');       
        Http h = new Http();        
        HttpRequest reqst = new HttpRequest();      
        reqst.setMethod('GET'); 
        reqst.setHeader('Authorization', 'apikey '+MCDetails.API_Key__c);
        reqst.setEndpoint('https://'+MCDetails.Domain_Name__c+'.api.mailchimp.com/3.0/campaigns?status='+strCampaignStatus+'&since_create_time='+campaignCreatedDateTimeStr);
        reqst.setTimeout(120000);
        HttpResponse res = new HttpResponse();
        string strResponseBody;
        if(!Test.isRunningTest())
        {           
            res = h.send(reqst); 
            strResponseBody = res.getBody();
            System.debug('Campaign count Response Body-----'+strResponseBody );  
        }    
        else
        {
            res.setStatusCode(200);
            strResponseBody ='{ "campaigns": [{ "id": "cfbbc15edd", "status": "sent", "recipients": { "list_id": "d91be5086a"}, "settings": { "subject_line": "Marketing", "reply_to": "indumathi_v@preludesys.com" } }] }';
            count=1;
        }
          if(res.getStatusCode() == 200)
          {  
              Map<String, Object> mapRespJSON = (Map<String, Object>)JSON.deserializeUntyped(strResponseBody);
              if(mapRespJSON.containsKey('total_items'))
                    count = integer.Valueof(mapRespJSON.get('total_items')); 
          }  
        System.debug('Campaign Count:========='+count);
        return count;
      }
      catch(System.CalloutException ex)
      {
        System.debug('## Exception in getMCCmpngCount ##'+ex);
        return count;
      } 
    }
    
     ///OBJECTIVE
    ///Method to Send Campaign to eligible candidates
    ///OBJECTIVE    
    public static void sendMCCampaign(Mailchimp_Details__c MailChimpCustomSetting, string CampaignId)    
    {                          
        try
        {
          Http h = new Http();        
          HttpRequest reqst = new HttpRequest();  
          reqst.setMethod('POST'); 
          reqst.setHeader('Authorization', 'apikey '+MailChimpCustomSetting.API_Key__c);          
          reqst.setEndpoint('https://'+MailChimpCustomSetting.Domain_Name__c+'.api.mailchimp.com/3.0/campaigns/'+CampaignId+'/actions/send');       
          reqst.setTimeout(120000);
          if(!Test.isRunningTest())
          { 
              HttpResponse res = h.send(reqst);  
              System.debug('success in sendMCCampaign');       
          }
        }
        catch(System.CalloutException ex)
        {
            System.debug('Exception in sendMCCampaign'+ex.getMessage());           
        }
        
      
    }   */
}